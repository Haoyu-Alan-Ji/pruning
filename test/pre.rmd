---
title: "pre"
author: "Haoyu Ji"
institute: Department of Biostatistics, University of Minnesota
date: "`r Sys.Date()`"
output:
  slidy_presentation:
      self_contained: true 
      font_adjustment: -1
      slide_level: 1
bibliography: ../pre.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(Matrix)
library(ape)
library(tidyverse); theme_set(theme_bw())
library(expm)
library(RTMB)
```

# Preparation Instructions

```{r seed}
set.seed(427)
```

```{r funs, message = FALSE, warning=FALSE}
source(here::here("R", "Q_template.R"))
source(here::here("R", "getinfo.R"))
source(here::here("R", "realtree.R"))
```

```{r realdat}
fish_traits <- read.csv(here::here('data', "binaryTraitData.csv"))
fish_tree   <- readRDS(here::here('data', "treeSingle.rds"))
```

```{r clean3traits}
ctraits <- fish_traits[fish_traits$species %in% fish_tree$tip.label, ]

ctraits <- ctraits[match(fish_tree$tip.label, ctraits$species), ]

c_traits <- data.frame(
  Species = ctraits$species,
  ag = ctraits$ag,
  care = ctraits$care,
  spawning = ctraits$spawning
)

c_traits <- c_traits[!is.na(c_traits$care) & !is.na(c_traits$spawning), ]
c_tree <- drop.tip(fish_tree, setdiff(fish_tree$tip.label, c_traits$Species))

c_traits <- c_traits[match(c_tree$tip.label, c_traits$Species), ]
```

```{r}
tax_plot <- ctraits |>
  distinct(order, species) |>           # 每个物种只算一次
  group_by(order) |>
  mutate(spec_index = row_number()) |>  # 在每个 order 内给物种一个编号
  ungroup()

ggplot(tax_plot, aes(x = spec_index, y = reorder(order, spec_index, max))) +
  geom_point(alpha = 0.5, size = 0.3) +
  labs(
    x = "Species index within order",
    y = "Order (ordered by #species)",
    title = "Distribution of species across orders"
  ) +
  theme_minimal()

```

